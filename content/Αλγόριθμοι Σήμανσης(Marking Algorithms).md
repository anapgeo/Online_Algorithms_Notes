
## Αλγόριθμοι Σήμανσης

Οι αλγόριθμοι σήμανσης για την επίλυση του προβήματος της κρυφής μνήμης είναι μια **κλάση αλγορίθμων** οι οποίοι περιγράφονται από τον παρακάτω ψευδοκώδικα:

![[Screenshot_22.png]]


Καταλαβαίνουμε πως ο ψευδοκώδικας αυτός περιγράφει μια κλάση αλγορίθμων και όχι κάποιο συγκεκριμένο αλγόριθμο καθώς δεν καθορίζει με πιο τρόπο απομακρύνεται ένα unmarked στοιχείο από την cache. Υπάρχουν πληθώρα επιλογών κριτηρίων για την απομάκρυνση κάποιου unmarked στοιχείου. Τα κριτήρια αυτά μπορεί να είναι τόσο ντετερμινιστικά όσο και τυχαιοκρατικά.

Στη συνέχεια βλέπουμε ένα παράδειγμα εφαρμογής ενός marking αλγόριθμου για μνήμη cache με τρείς θέσεις(k=3), και 5 διαφορετικά πιθανά σύμβολα(N=5). Αρχικά η cache ειναι κενή.
![[Screenshot_20.png]]
![[Screenshot_19.png]]

> Σημείωση: Ο αλγόριθμος LRU είναι επι της ουσίας ένας marking αλγόριθμος. Το κριτήριο απομάκρυνσης ενός unmarked στοιχείου είναι το ποιο κελί της cache έχει προσπελαστεί πιο παλιά. Παρακάτω φαίνεται και ένα παράδειγμα λειτουργίας του LRU.
![[Screenshot_21.png]]


## Ανταγωνιστικότητα Αλγορίθμων Σήμανσης

> **Θεώρημα**: Κάθε αλγόριθμος σήμανσης είναι k-ανταγωνιστικός 

Απόδειξη 



Ας εξετάσουμε έναν οποιοδήποτε αλγόριθμο σήμανσης σε μια cache με k θέσεις. Συγκεκριμένα έχουμε μια ακολουθία αιτημάτων $\sigma$. 

Αρχικά θα χρειαστεί να βρούμε ένα άνω όριο για τα cache misses του αλγορίθμου σήμανσης.

Εξετάζουμε μια τυχαία φάση εκτέλεσης του αλγορίθμου στην οποία η cache είναι γεμάτη, έχοντας k διακριτά στοιχεία. Έστω ότι ζητείται μια ακολουθία που περιέχει k διακριτά στοιχεία, στην περίπτωση αυτή φτάνουμε σε ένα σημείο όπου όλα τα στοιχεία της cache θα είναι marked. Εφόσον όταν κάποιο από τα k στοιχεία όταν ζητηθεί γίνεται marked και παραμένει στην cache για όλη τη διάρκεια της φάσης, αυτό σημαίνει πως τα cache misses που έχουν γίνει στη διάρκεια της φάσης αυτής είναι το πολύ k(στην περίπτωση όπου τα k διακριτά στοιχεία που ζητήθηκαν είναι όλα διαφορετικά από αυτά που υπήρχαν αρχικά στην cache). H φάση τελειώνει επίσημα όταν ζητηθεί κάποιο διαφορετικό από τα k στοιχεία που προηγήθηκαν και η προηγούμενη ανάλυση επαναλαμβάνεται για την επόμενη φάση.

Επομένως σαν συμπέρασμα έχουμε:

> **Πρόταση 1**: Ο αλγόριθμος σήμανσης επιφέρει το πολύ $k$ αστοχίες ανα φάση, με σύνολο το πολύ $kr$ αστοχίες σε $r$ φάσεις

Στη συνέχεια θα προσπαθήσουμε να βρούμε ένα κάτω όριο για τα cache misses του βέλτιστου αλγορίθμου. 

Ο βέλτιστος αλγόριθμος, αναγκαστικά θα κάνει τουλάχιστον 1 λάθος στο τέλος κάθε φάσης καθώς ακόμα και αν τα k στοιχεία που έχει στην cache στην αρχή κάθε φάσης είναι ίδια με τα στοιχεία που θα ζητηθούν στα αιτήματα της φάσης αυτής, όταν η φάση τελειώσει θα ζητηθεί ένα στοιχείο που ανήκει στο σύνολο των k+1 διακριτών στοιχείων. Αναγκαστικά τότε θα πρέπει να υπάρξει μια αστοχία του αλγορίθμου. 

Επομένως έχουμε το εξής συμπέρασμα:

> **Πρόταση 2**: Ο βέλτιστος αλγόριθμος θα επιφέρει τουλάχιστον $r-1$ αστοχίες, όπου $r$ ο αριθμός των φάσεων. Άρα για τα συνολικά σφάλματα $f(\sigma)$ του βέλτιστου αλγορίθμου θα ισχύει $f(σ)\geq r-1$

Αξιοποιώντας τις παραπάνω προτάσεις καταλήγουμε στο εξής:

> **Συμπέρασμα**: Για κάθε αλγόριθμο σήμανσης ο αριθμός των αστοχιών που επιφέρει μια ακολουθία $\sigma$ είναι το πολύ $k\cdot f(\sigma) + k$ 

Αυτό γιατί : 
$$
kr=k(r-1)+k\leq k \cdot f(\sigma) + k
$$

> Σημείωση: Ιδιαίτερο ενδιαφέρον έχει ο LRU, για τον οποίο το καλύτερο δυνατό όριο είναι το $k\cdot f(\sigma) + k$, καθώς στο πλαίσιο του competitive analysis όπου κάποιος αντίπαλος επιλέγει την ακολουθία των αιτημάτων, μπορεί να επιλέξει να γίνεται συνεχώς αίτημα συγκεκριμένων $k+1$ στοιχείων με κυκλικό(περιοδικό τρόπο). Στην περίπτωση αυτή ο αλγόριθμος LRU θα επιφέρει $k$ αστοχίες σε κάθε φάση. 
## Τυχαιοποιημένος Αλγόριθμος Σήμανσης

Μπορούμε να πετύχουμε καλύτερη ανταγωνιστικότητα σε σύγκριση με τους ντετερμινιστικούς αλγορίθμους σήμανσης; Όπως θα γίνει φανερό στη συνέχεια, αυτό είναι δυνατό με την χρήση τυχαιοποιημένων αλγορίθμων σήμανσης. Ο ψευδοκώδικας ενός τέτοιου τυχαιοποιημένου αλγορίθμου φαίνεται παρακάτω(η μόνη διαφορά με τον ντετερμινιστικό είναι η τυχαία επιλογή απομάκρυνσης του unmarked στοιχείου):


![[Screenshot_2024-06-14_18-42-34.png]]

Μπορούμε να αποδείξουμε πως ο τυχαιοποιημένος αλγόριθμος που αναφέραμε είναι $Ο(log k)$-ανταγωνιστικός

### Ανάλυση Τυχαιοποιημένου Αλγόριθμου

> **Θεώρημα**: Ο τυχαιοποιημένος αλγόριθμος σήμανσης είναι O(log k)-ανταγωνιστικός.

Απόδειξη

Η ανάλυση μας σε αυτή την απόδειξη βασίζεται στην ανάλυση που είχαμε κάνει και για τους ντετερμινιστικούς αλγορίθμους αλλά με κάποιες τροποποιήσεις.

Συγκεκριμένα, η ανάλυση μας θα πρέπει να γίνει λίγο πιο εκλεπτυσμένη θα λέγαμε. Αυτό γιατί ναι μεν ο τυχαιοποιημένος αλγόριθμος θα μπορούσε να κάνει $kr$ αστοχίες αλλά αυτό είναι αρκετά πιο απίθανο να συμβεί σε σύγκριση με τον ντετερμινιστικό αλγόριθμο. Μια απλή περίπτωση που αυτό θα μπορούσε να συμβεί είναι τα k στοιχεία που θα ζητηθούν σε μια φάση του αλγορίθμου να είναι όλα διαφορετικά από αυτά που ζητήθηκαν στην ακριβώς προηγούμενη φάση. Επί της ουσίας όμως μια τέτοια περίπτωση θα οδηγούσε σε μεγάλο αριθμό αστοχιών και το βέλτιστο αλγόριθμο. Έτσι δεν θα ίσχυε το κάτω όριο του $r-1$.


Θα διαχωρίσουμε τα unmarked στοιχεία μιας φάσης $j$, σε: 
- φρέσκα στοιχεία: δεν έχουν ζητηθεί στην j-1 φάση 
- παλιά στοιχεία: έχουν ζητηθεί στην j-1 φάση

Σε κάθε φάση j γίνονται αιτήματα για k unmarked στοιχεία. Θα συμβολίζουμε τα φρέσκα στοιχεία της φάσης $j$ ως $c_j$. Τα παλιά στοιχεία είναι $k-c_j$.

