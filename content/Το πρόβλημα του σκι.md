## Το πρόβλημα

- Είμαστε σε διακόπες σε ένα χιονοδρομικό και θέλουμε να μάθουμε σκι
- Η ενοικίαση εξοπλισμού σκι κοστίζει 20 ευρώ/ημέρα
- Η αγορά του εξοπλισμού κοστίζει 200 ευρώ
- Δεν γνωρίζουμε για πόσες μέρες θα μας αφήσουν να μείνουμε στο χιονοδρομικό
- Η είσοδος μας είναι τα αιτήματα $\large σ=(σ_1,...,σ_t,...)$
- Έστω $\large σ_i$ το αίτημα της μέρας $i$
	- Αν $\large σ_i=Μ$ παραμένουμε στο χιονοδρομικό
	- Αν $\large σ_i=Δ$ αποχωρούμε από το χιονοδρομικό
- Ως $\large I_j$ συμβολίζουμε την ακολουθία εκείνη σύμφωνα με την οποία θα παραμείνουμε στο χιονοδρομικό για j ημέρες. Πχ $\large I_3=(Μ,Μ,Μ,Δ)$
- Ο στόχος μας είναι να πληρώσουμε όσο το δυνατον λιγότερα χρήματα σε σύγκριση με το βέλτιστο που θα μπορούσαμε να πράξουμε αν ξέραμε τι θα συνέβαινε
- Όπου βέλτιστο εννούμε $\large OPT(I_j)= \min\{ 200,20j\}$
- Έστω $\large ALG_i$ ο αλγόριθμος που νοικιάζει μέχρι και τη μέρα $\large i-1$ και στη συνέχεια αγοράζει τον εξοπλισμό την ημέρα $\large i$



## Competitive Analysis

Για τον αλγόριθμο $\large ALG$ που θα επιλέξουμε έχουμε $\large ALG(σ)$ να είναι το ποσό που θα πληρώσουμε.  Επίσης $\large OPT(σ)$ είναι το κόστος της βέλτιστης λύσης αν γνωρίζαμε την ακολουθία $\large σ$, όπου θα ήταν μια ακολουθία $\large I_j$. Φυσικά $\large OPT(I_j)= \min\{ 200,20j\}$. 

Άρα αφού τα $\large ALG(σ)$ και $\large OPT(σ)$ εκφράζουν κόστοι, το competitive ratio μας θα είναι $$\large \max_σ\frac{ALG(σ)}{OPT(σ)}$$

Παράδειγμα: Έστω ότι επιλέγουμε τον αλγόριθμo $\large ALG_2$ σύμφωνα με τον οποίο ενοικιάζουμε την πρώτη μέρα και αγοράζουμε τη επόμενη. Τότε έστω ακολουθία $\large σ=(Μ,Μ,Μ,Δ)=Ι_3$.
$$ALG_2(\sigma)= 20 + 200=220$$
ενώ
$$OPT(\sigma)= 20 +20+20=60$$

Άρα $$\frac{ALG_2(σ)}{OPT(σ)}=220/60=22/6$$
## Ο βέλτιστος αλγόριθμος 



Ο βέλτιστος αλγόριθμος για το πρόβλημα μας είναι ο $\large ALG_{10}$, ο οποίος έχει λόγο ανταγωνισμού το πολύ 2.

### Απόδειξη:

Θεωρούμε 2 πιθανές περιπτώσεις για την είσοδο $\large I_j$

**Περίπτωση 1 ($\large j < 10$)**: 
- $\large ALG_{10}(I_j)=20j$
- $\large OPT(I_j)=min(20j,200)=20j$
- $\large r=1$
  
**Περίπτωση 2 ($\large j \geq 10$)**: 
- $\large ALG_{10}(I_j)=9 \cdot 20 +200=380$
- $\large OPT(I_j)=min(20j,200)=200$
- $\large r=380/200 \leq 2$

### Γενίκευση της απόδειξης

- Έστω κόστος ενοικίασης 1 ευρώ/μέρα
- Και κόστος αγοράς Β ευρω, όπου Β ακέραιος >1

Ο βέλτιστος αλγόριθμος είναι ο $\large ALG_B$ και έχει competitive ratio το πολύ $\large 2-\frac{1}{B}$

**Απόδειξη** :

**Περίπτωση 1 ($\large j < Β$)**: 
- $\large ALG_{Β}(I_j)=OPT(I_j)=j$
- $\large r=1$
  
**Περίπτωση 2 ($\large j \geq 10$)**: 
- $\large ALG_{Β}(I_j)=(Β-1) +Β= 2Β -1$
- $\large OPT(I_j)=Β$
- $\large r=\max_j r(I_j)=2-\frac{1}{B}$


## Κάτω Φράγμα

Μπορούμε να αποδείξουμε πως δεν υπάρχει κανένας ντετερμινιστικός άμεσος αλγόριθμος ο οποίος να πετυχαίνει λόγο ανταγωνισμού μικρότερο από $\large 2-\frac{1}{B}$;


### Λήμμα 

Δεν υπάρχει ντετερµινιστικός αλγόριθµος µε λόγο ανταγωνισµού καλύτερο από $\large 2-\frac{1}{B}$

**Απόδειξη**:

- Εστω ότι επιλέγουμε ένα ντετερμινιστικό αλγόριθμο $\large ALG_i$ 
- Ο αντίπαλος μας για να επιτύχει το μεγαλύτερο δυαντό competitive ratio επιλέγει πάντα να τερματίσει τη διαμονή μας στο χιονοδρομικό τη μέρα που αγοράσαμε τον εξοπλισμό άρα θα μας δίνει ως είσοδο την ακολουθία $\large Ι_i$. 

**Περίπτωση 1 ($\large i < Β$)**: 
- $\large ALG_{i}(I_i)= (i-1) + B$
- $\large OPT(I_i)= i$
- $\large r=\frac{(i-1)+B}{i}=1 +\frac{B-1}{i}\geq 1 +\frac{B-1}{B}= 2- \frac{1}{B}$
  
**Περίπτωση 2 ($\large i \geq B$)**: 
- $\large ALG_{i}(I_i)=(i-1) +Β$
- $\large OPT(I_j)=Β$
- $\large r=\frac{i-1+B}{B} \geq \frac{2B-1}{B}= 2-\frac{1}{B}$ άρα πετυχαίνουμε το κάτω φράγμα $2-\frac{1}{B}$ για $i=B$
---


## Τυχαιοποιημένος Αλγόριθμος

Μπορούμε να βελτιώσουμε το competitive ratio χρησμιμοποιώντας τυχαιοποίηση στον αλγόριθμο μας;

Ένας τυχαιοποιημένος αλγόριθμος είναι μια πιθανοτική κατανομή πάνω σε ντετερμινιστικούς αλγορίθμους. 
- πχ με πιθανότητα 1/3 επιλέγουμε τον $ALG_1$ και με 2/3 τον $ALG_3$

Στη συνέχεια υπολογίζουμε το αναμενόμενο κόστος $\mathbb{E}[ALG(\sigma)]$ του τυχαιοποιημένου αλγορίθμου για μια ακολουθία $\sigma$ 

To competitive ratio είναι ο μεγαλύτερος(χειρότερος) λόγος $\large \frac{\mathbb{E}[ALG(σ)]}{OPT(σ)}$  δεδομένων των δυνατών ακολουθιών $\large \sigma$: 
$$\large \max_\sigma\frac{\mathbb{E}[ALG(σ)]}{OPT(σ)}$$
### Warm Up

Πάμε να εξετάσουμε μια απλή περίπτωση τυχαιοποιημένου αλγορίθμου για να δούμε πως λειτουργεί η τυχαιοποίηση στους αλγορίθμους

Σε μια πρώτη προσπάθει δημιουργίας ενός τυχαιοποιημενου αλγορίθμου επιλέγουμε
- με πιθανότητα p το αλγόριθμο $ALG_{B/2}$
- με πιθανότητα 1-p τον αλγόριθμο $ALG_{B}$

Στη συνέχεια ο αντίπαλος μας θα πρέπει να επιλέξει τη χειρότερη δυνατή είσοδο:

Οι πιθανές χειρότερες είσοδοι είναι $I_{B/2}$ και $I_{B}$ **

Για είσοδο $I_{B/2}$:

- $\mathbb{E}[ALG(I_{B/2})]=p \cdot ALG_{B/2}(I_{B/2}) + (1-p)\cdot ALG_B(I_{B/2}))=p \cdot (B+B/2) + (1-p)\cdot (B/2)$
- $OPT(I_{B/2})= B/2$
- $r(I_{B/2})= \frac{\mathbb{E}[ALG(I_{B/2})]}{OPT(I_{B/2})}=2p +1$

Για είσοδο $I_{B}$:

- $\mathbb{E}[ALG(I_{B})]=p \cdot ALG_{B/2}(I_{B}) + (1-p)\cdot ALG_B(I_{B}))=p \cdot (B+B/2) + (1-p)\cdot (B-1 + Β) \leq p \cdot (B+B/2) + (1-p)\cdot (2B)$
- $OPT(I_{B})= B$
- $r(I_{B/2})= \frac{\mathbb{E}[ALG(I_{B})]}{OPT(I_{B})}\leq \frac{B \cdot[(p \cdot 3/2) + (2-2p)]}{B}=2+ 3/2 \cdot p-2p=2-p/2$

Επιλέγοντας την τιμή του p=2/5 που εξισώνει τους παραπάνω λόγους ανταγωνισμού πετυχαίνουμε λόγο ανταγωνισμού μικρότερο ή ίσο με 9/5, αυτό αποτελεί βελτίωση σε σχέση με το $2-\frac{1}{B}$ που είχαμε βρεί για τους ντετερμινιστικούς αλγορίθμους(σκέψου πως για να μην ισχύει αυτό θα πρέπει $B<5$ δηλαδή η τιμή αγοράς να είναι μικρότερη από πέντε φορές την τιμή ενοικίασης)


** Αυτές είναι οι δύο χειρότερες είσοδοι καθώς σκεφτείτε το εξής:
- Η είσοδος $I_{B/2}$ είναι η χειρότερη είσοδος για τον αλγόριθμο $ALG_{B/2}$
- Η είσοδος $I_{B}$ είναι η χειρότερη είσοδος για τον αλγόριθμο $ALG_{B}$
Επομένως οποιαδήποτε άλλη είσοδος είναι ευνοϊκότερη για τους αλγορίθμους αυτούς



### Ο Τυχαιοποιημένος Αλγόριθμος για το πρόβλημα του σκι 

Πάμε τώρα να εξετάσουμε τη γενικευμένη εκδοχή της τυχαιοποίησης για το πρόβλημα του σκι.

Ορίζουμε αρχικά:
- κόστος ενοικίασης: 1 ευρώ/µέρα
- κόστος αγοράς: $Β$ ευρώ

Θα θέσουμε το $B=4$ για να διευκολύνουμε την ανάλυση μας. 

Στη συνέχεια δημιουργούμε έναν πίνακα όπου κάθε κελί θα του θα περιέχει το λόγο ανταγωνισμού που αντιστοιχεί σε έναν αλγόριθμο δεδομένης μιας εισόδου. Για παράδειγμα:
- Το κελί $(i,j)$ περιέχεται ο λόγος ανταγωνισμού του αλγορίθμου $ALG_i$ δεδομένης της εισόδου $I_j$. Δηλαδή περιέχει την τιμή $\frac{ALG_i(I_j)}{OPT(I_j)}$

![[Screenshot_7.png]]


Όπως αναφέραμε και προηγουμένως ένας τυχαιοποιημένος αλγόριθμος είναι μια κατανομή πάνω στους πιθανούς ντετερμινιστικούς αλγορίθμους. Με απλά λόγια θα πρέπει να ορίσουμε μια τιμή πιθανότητα $p_i$ με βάση την οποία θα επιλέγουμε έναν αλγόριθμο $ALG_i$. 
![[Screenshot_8.png]]

Αφού κάνουμε εμείς την επιλογή της κατανομής αυτής, ο αντίπαλος(adversary) μας θα επιλέξει την χειρότερη δυνατή για μας είσοδο, δηλαδή την είσοδο $I_j$ που μεγιστοποιεί το λόγο ανταγωνισμού $\frac{\mathbb{E}[ALG_i(I_j)]}{OPT(I_j)}$. Επομένως ως αντίπαλοι επιλέγουμε την στήλη την οποία επιθυμούμε, είμαστε οι "στηλοπαίκτες" όπως λέμε στην θεωρία παιγνίων.

Εξετάζοντας τον πίνακα παρατηρούμε πως οι στήλες που αντιστοιχούν στις εισόδους $I_4,I_5,...$ περιέχουν τιμές λόγου ανταγωνισμού μικρότερες οι ίσες αυτών που περιέχονται στη στήλη $I_{\infty}$, επομένως μπορούμε να αποκλείσουμε όλες τις στήλες $I_4,I_5,...$ και να κρατήσουμε τη στήλη $I_{\infty}$ καθώς με αυτή πετυχαίνουμε το ίδιο καλό ή και καλύτερο αποτέλεσμα από το να επιλέγαμε οποιαδήποτε από τις αποκλεισμένες στήλες. 

![[Screenshot_9.png]]

Στη συνέχεια, έχοντας κρατήσει μόνος τις 4 πιθανές επιλογές του αντιπάλου(adversary) πάμε να δούμε μήπως και εμείς ως σχεδιαστές μπορούμε να αποκλείσουμε κάποιους από τους αλγορίθμους μας.

Παρατηρούμε πως στις 4 στήλες που έχουν απομείνει δεν μας συμφέρει να επιλέξουμε κάποιον από τους αλγορίθμους που βρίσκονται σε γραμμές κάτω από τον $ALG_4$, καθώς πευχαίνουμε ακριβώς τον ίδιο λόγο ανταγωνισμού για τις στήλες $Ι_1,Ι_2,Ι_3$ και μεγαλύτερο λόγο ανταγωνισμού στη στήλη $I_{\infty}$. Δεδομένου πως ως σχεδιαστές θέλουμε να μειώσουμε όσο το δυνατόν περισσότερο τον λόγο ανταγωνισμού δεν έχουμε κανένα κίνητρο να επιλέξουμε κάποια γραμμή κάτω από το $ALG_4$, επομένως οι γραμμές αυτές θα επιλέγονται με πιθανότητα 0.

![[Screenshot_10.png]]

Ο πίνακας που έχει μείνει μετά τους λογικούς αποκλεισμούς τους οποίους κάναμε είναι:
![[Screenshot_11.png]]

Γενικά ισχύει: 
- $p_1+p_2+p_3+p_4=1$
- 